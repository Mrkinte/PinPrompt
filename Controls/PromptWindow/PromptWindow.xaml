<Window
    x:Class="PinPrompt.Controls.PromptWindow.PromptWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helper="clr-namespace:PinPrompt.Helpers"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:PinPrompt.Controls.PromptWindow"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
    Title="{Binding Title}"
    Width="{Binding WindowWidth, Mode=TwoWay}"
    Height="{Binding WindowHeight, Mode=TwoWay}"
    local:AttachedProperties.IsActivated="{Binding IsActivated}"
    local:AttachedProperties.IsSnapToEdge="{Binding IsSnapToEdge}"
    local:AttachedProperties.ResizeMode="{Binding WResizeMode}"
    AllowsTransparency="True"
    Background="Transparent"
    Left="{Binding LeftPosition, Mode=TwoWay}"
    MouseEnter="Window_MouseEnter"
    MouseLeftButtonDown="Window_MouseLeftButtonDown"
    MouseLeftButtonUp="Window_MouseLeftButtonUp"
    ResizeMode="NoResize"
    ShowInTaskbar="False"
    Top="{Binding TopPosition, Mode=TwoWay}"
    Topmost="{Binding IsTop}"
    WindowStyle="None"
    mc:Ignorable="d">
    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome
            CaptionHeight="0"
            CornerRadius="0"
            GlassFrameThickness="0"
            ResizeBorderThickness="6" />
    </shell:WindowChrome.WindowChrome>
    <Grid>
        <Grid.Resources>
            <helper:InvertibleBooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <ContextMenu x:Key="PreviewContextMenu" DataContext="{Binding}">
                <MenuItem Click="MenuItem_Click" Header="关闭" />
            </ContextMenu>
        </Grid.Resources>
        <Grid.Style>
            <Style TargetType="Grid">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsActivated}" Value="False">
                        <Setter Property="ContextMenu" Value="{StaticResource PreviewContextMenu}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>
        <Border
            Padding="0"
            Background="{Binding BackgroundColor}"
            CornerRadius="{Binding BackgroundRadius}">
            <FlowDocumentScrollViewer
                x:Name="FlowDocumentViewer"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Document="{Binding Document}"
                HorizontalScrollBarVisibility="Disabled"
                IsEnabled="False"
                Opacity="{Binding Opacity}"
                VerticalScrollBarVisibility="Disabled" />
        </Border>
        <StackPanel
            Height="30"
            HorizontalAlignment="Center"
            VerticalAlignment="Top"
            Orientation="Horizontal"
            Visibility="{Binding IsActivated, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}">
            <TextBlock
                x:Name="PreviewText"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                FontSize="20"
                FontWeight="Bold"
                Foreground="Red"
                Text="预 览 提 示">
                <TextBlock.Triggers>
                    <EventTrigger RoutedEvent="TextBlock.Loaded">
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever">
                                <ColorAnimation
                                    AutoReverse="True"
                                    Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)"
                                    From="Red"
                                    To="Black"
                                    Duration="0:0:1" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </TextBlock.Triggers>
            </TextBlock>
            <Border
                Width="14"
                Height="14"
                Margin="10,0,0,0"
                VerticalAlignment="Center"
                Background="Red"
                CornerRadius="7">
                <Border.Triggers>
                    <EventTrigger RoutedEvent="Border.Loaded">
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever">
                                <ColorAnimation
                                    AutoReverse="True"
                                    Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                    From="Red"
                                    To="Black"
                                    Duration="0:0:1" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Border.Triggers>
            </Border>
        </StackPanel>
    </Grid>
</Window>
